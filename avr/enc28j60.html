<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>What you should know about ENC28J60 Ethernet Controller before interfacing it? | SANTOSH DAHAL</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async="async"></script>
    <script>
       (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6356177594937247",
    enable_page_level_ads: true
  });
    </script>
    <meta name="description" content="The ENC28J60 is a stand-alone Ethernet controller with an industry standard Serial Peripheral Interface (SPI™). It is designed to serve as an Ethernet network interface for any controller equipped with SPI.">
    <meta name="image" content="https://www.suntos.com.np/spiblocks.png">
    <meta name="twitter:title" content="What you should know about ENC28J60 Ethernet Controller before interfacing it?">
    <meta name="twitter:description" content="The ENC28J60 is a stand-alone Ethernet controller with an industry standard Serial Peripheral Interface (SPI™). It is designed to serve as an Ethernet network interface for any controller equipped with SPI.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://www.suntos.com.np/spiblocks.png">
    <meta name="twitter:url" content="https://www.suntos.com.np/avr/enc28j60.html">
    <meta name="twitter:site" content="@IMSdahal">
    <meta property="og:type" content="article">
    <meta property="og:title" content="What you should know about ENC28J60 Ethernet Controller before interfacing it?">
    <meta property="og:description" content="The ENC28J60 is a stand-alone Ethernet controller with an industry standard Serial Peripheral Interface (SPI™). It is designed to serve as an Ethernet network interface for any controller equipped with SPI.">
    <meta property="og:image" content="https://www.suntos.com.np/spiblocks.png">
    <meta property="og:url" content="https://www.suntos.com.np/avr/enc28j60.html">
    <meta property="og:site_name" content="Santosh Dahal">
    <meta itemprop="name" content="What you should know about ENC28J60 Ethernet Controller before interfacing it?">
    <meta itemprop="description" content="The ENC28J60 is a stand-alone Ethernet controller with an industry standard Serial Peripheral Interface (SPI™). It is designed to serve as an Ethernet network interface for any controller equipped with SPI.">
    <meta itemprop="image" content="https://www.suntos.com.np/spiblocks.png">
    <meta name="msvalidate.01" content="DEBC46DE5780BB248603A3691FAF28C9">
    <meta name="google-site-verification" content="c2al3aJPT-Rv_1iyfytLUfEf_Mc5_N06Pfb8H-spn00">
    <meta name="msapplication-TileImage" ccontent="/ms-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <link rel="preload" href="/assets/css/0.styles.c707e939.css" as="style"><link rel="preload" href="/assets/js/app.b9d4e7ea.js" as="script"><link rel="preload" href="/assets/js/3.32f2e6ee.js" as="script"><link rel="preload" href="/assets/js/22.5a6e4eea.js" as="script"><link rel="preload" href="/assets/js/9.20302103.js" as="script"><link rel="prefetch" href="/assets/js/10.641e508c.js"><link rel="prefetch" href="/assets/js/100.52fdb349.js"><link rel="prefetch" href="/assets/js/101.e40e4d8d.js"><link rel="prefetch" href="/assets/js/102.addec789.js"><link rel="prefetch" href="/assets/js/103.0cc34dbe.js"><link rel="prefetch" href="/assets/js/104.1970f50e.js"><link rel="prefetch" href="/assets/js/105.7406ee39.js"><link rel="prefetch" href="/assets/js/106.dfe90b8d.js"><link rel="prefetch" href="/assets/js/107.ae03384f.js"><link rel="prefetch" href="/assets/js/108.dfd9d31e.js"><link rel="prefetch" href="/assets/js/109.fa564a9d.js"><link rel="prefetch" href="/assets/js/11.f616fc6b.js"><link rel="prefetch" href="/assets/js/110.18c287b6.js"><link rel="prefetch" href="/assets/js/111.e6b4d1f3.js"><link rel="prefetch" href="/assets/js/112.7f9534fe.js"><link rel="prefetch" href="/assets/js/113.e8e2a7f4.js"><link rel="prefetch" href="/assets/js/114.6ffd5c4b.js"><link rel="prefetch" href="/assets/js/115.90e7b9bd.js"><link rel="prefetch" href="/assets/js/116.49c4a636.js"><link rel="prefetch" href="/assets/js/117.298449d2.js"><link rel="prefetch" href="/assets/js/118.0473cb0f.js"><link rel="prefetch" href="/assets/js/119.53c2a836.js"><link rel="prefetch" href="/assets/js/12.2e3b6d0b.js"><link rel="prefetch" href="/assets/js/120.5b2546b9.js"><link rel="prefetch" href="/assets/js/121.d72340b0.js"><link rel="prefetch" href="/assets/js/122.15ead973.js"><link rel="prefetch" href="/assets/js/123.8e3cacb8.js"><link rel="prefetch" href="/assets/js/124.db55bd79.js"><link rel="prefetch" href="/assets/js/125.d2109866.js"><link rel="prefetch" href="/assets/js/126.cd5a284d.js"><link rel="prefetch" href="/assets/js/127.9eb61236.js"><link rel="prefetch" href="/assets/js/128.6560bafc.js"><link rel="prefetch" href="/assets/js/129.962abcfb.js"><link rel="prefetch" href="/assets/js/13.00afb70b.js"><link rel="prefetch" href="/assets/js/130.4de3219c.js"><link rel="prefetch" href="/assets/js/131.f8f5b8d0.js"><link rel="prefetch" href="/assets/js/132.d2c4e56f.js"><link rel="prefetch" href="/assets/js/133.3981616a.js"><link rel="prefetch" href="/assets/js/134.f88e8cf6.js"><link rel="prefetch" href="/assets/js/135.486273a8.js"><link rel="prefetch" href="/assets/js/136.e7c2670f.js"><link rel="prefetch" href="/assets/js/137.03494e3a.js"><link rel="prefetch" href="/assets/js/138.49d51531.js"><link rel="prefetch" href="/assets/js/139.044e23ef.js"><link rel="prefetch" href="/assets/js/14.69ff453f.js"><link rel="prefetch" href="/assets/js/15.465c91da.js"><link rel="prefetch" href="/assets/js/16.8575963f.js"><link rel="prefetch" href="/assets/js/17.c99943ec.js"><link rel="prefetch" href="/assets/js/18.f16cf776.js"><link rel="prefetch" href="/assets/js/19.c45782b7.js"><link rel="prefetch" href="/assets/js/20.8db96560.js"><link rel="prefetch" href="/assets/js/21.6b34bf8e.js"><link rel="prefetch" href="/assets/js/23.2f70099d.js"><link rel="prefetch" href="/assets/js/24.c4df263b.js"><link rel="prefetch" href="/assets/js/25.1c6c3585.js"><link rel="prefetch" href="/assets/js/26.89ee6620.js"><link rel="prefetch" href="/assets/js/27.fad443aa.js"><link rel="prefetch" href="/assets/js/28.529afeb8.js"><link rel="prefetch" href="/assets/js/29.7c2bbdb7.js"><link rel="prefetch" href="/assets/js/30.5a882feb.js"><link rel="prefetch" href="/assets/js/31.7fb653eb.js"><link rel="prefetch" href="/assets/js/32.a89462bb.js"><link rel="prefetch" href="/assets/js/33.4e04a9c4.js"><link rel="prefetch" href="/assets/js/34.5835c1ba.js"><link rel="prefetch" href="/assets/js/35.568de355.js"><link rel="prefetch" href="/assets/js/36.9b10ba5b.js"><link rel="prefetch" href="/assets/js/37.fa5cd517.js"><link rel="prefetch" href="/assets/js/38.650f4616.js"><link rel="prefetch" href="/assets/js/39.3ab2791c.js"><link rel="prefetch" href="/assets/js/4.1900e11a.js"><link rel="prefetch" href="/assets/js/40.14ab0f25.js"><link rel="prefetch" href="/assets/js/41.4d166fe3.js"><link rel="prefetch" href="/assets/js/42.2f897565.js"><link rel="prefetch" href="/assets/js/43.d39cab03.js"><link rel="prefetch" href="/assets/js/44.5699d0e8.js"><link rel="prefetch" href="/assets/js/45.99c2450b.js"><link rel="prefetch" href="/assets/js/46.74f24b16.js"><link rel="prefetch" href="/assets/js/47.34905afd.js"><link rel="prefetch" href="/assets/js/48.092952b0.js"><link rel="prefetch" href="/assets/js/49.1612531c.js"><link rel="prefetch" href="/assets/js/5.8adab335.js"><link rel="prefetch" href="/assets/js/50.58fe1f0d.js"><link rel="prefetch" href="/assets/js/51.2e3a03bf.js"><link rel="prefetch" href="/assets/js/52.edf46f06.js"><link rel="prefetch" href="/assets/js/53.7504e1db.js"><link rel="prefetch" href="/assets/js/54.097cef3d.js"><link rel="prefetch" href="/assets/js/55.7a021ca7.js"><link rel="prefetch" href="/assets/js/56.ec91cd50.js"><link rel="prefetch" href="/assets/js/57.ecc98989.js"><link rel="prefetch" href="/assets/js/58.bd02c8e7.js"><link rel="prefetch" href="/assets/js/59.f793c46e.js"><link rel="prefetch" href="/assets/js/6.f73babb5.js"><link rel="prefetch" href="/assets/js/60.abb49391.js"><link rel="prefetch" href="/assets/js/61.da57dd14.js"><link rel="prefetch" href="/assets/js/62.be235428.js"><link rel="prefetch" href="/assets/js/63.4040c335.js"><link rel="prefetch" href="/assets/js/64.aa9d84af.js"><link rel="prefetch" href="/assets/js/65.ae2fd98e.js"><link rel="prefetch" href="/assets/js/66.5997dcd2.js"><link rel="prefetch" href="/assets/js/67.96820e48.js"><link rel="prefetch" href="/assets/js/68.e51a7f42.js"><link rel="prefetch" href="/assets/js/69.65d0527f.js"><link rel="prefetch" href="/assets/js/7.f7d7e41e.js"><link rel="prefetch" href="/assets/js/70.af375bb8.js"><link rel="prefetch" href="/assets/js/71.74c11c24.js"><link rel="prefetch" href="/assets/js/72.0cfb080b.js"><link rel="prefetch" href="/assets/js/73.a4496fdc.js"><link rel="prefetch" href="/assets/js/74.1120e77a.js"><link rel="prefetch" href="/assets/js/75.5cf8a6bf.js"><link rel="prefetch" href="/assets/js/76.01182de6.js"><link rel="prefetch" href="/assets/js/77.d77808b0.js"><link rel="prefetch" href="/assets/js/78.d0e20db4.js"><link rel="prefetch" href="/assets/js/79.a928eb50.js"><link rel="prefetch" href="/assets/js/8.095f95fc.js"><link rel="prefetch" href="/assets/js/80.265f75c9.js"><link rel="prefetch" href="/assets/js/81.92fb9bdb.js"><link rel="prefetch" href="/assets/js/82.fc545cdd.js"><link rel="prefetch" href="/assets/js/83.d3e47c02.js"><link rel="prefetch" href="/assets/js/84.fee65ded.js"><link rel="prefetch" href="/assets/js/85.2af1521a.js"><link rel="prefetch" href="/assets/js/86.64d4fe43.js"><link rel="prefetch" href="/assets/js/87.2956a90a.js"><link rel="prefetch" href="/assets/js/88.6ccebd33.js"><link rel="prefetch" href="/assets/js/89.be95c496.js"><link rel="prefetch" href="/assets/js/90.4086f581.js"><link rel="prefetch" href="/assets/js/91.c2cffd03.js"><link rel="prefetch" href="/assets/js/92.279b92c6.js"><link rel="prefetch" href="/assets/js/93.87e3a74e.js"><link rel="prefetch" href="/assets/js/94.e0e0a16a.js"><link rel="prefetch" href="/assets/js/95.d0ff6a34.js"><link rel="prefetch" href="/assets/js/96.95ee6e7b.js"><link rel="prefetch" href="/assets/js/97.f550ba8b.js"><link rel="prefetch" href="/assets/js/98.e65ecf8a.js"><link rel="prefetch" href="/assets/js/99.36a72b30.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.02b6005f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c707e939.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SANTOSH DAHAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/avr/" class="sidebar-link">Introduction</a></li><li><a href="/avr/enc28j60.html" class="active sidebar-link">What you should know about ENC28J60 Ethernet Controller before interfacing it?</a></li></ul> </aside> <main class="page"> <div class="content__default"><h1 id="functional-blocks"><a href="#functional-blocks" class="header-anchor">#</a> Functional Blocks :</h1> <p>The ENC28J60 is a stand-alone Ethernet controller with an industry standard Serial Peripheral Interface (SPI™). It is designed to serve as an Ethernet network interface for any controller equipped with SPI.</p> <p>The ENC28J60 consists of seven major functional blocks:</p> <h4 id="_1-an-spi-interface-that-serves-as-a-communication-channel-between-the-host-controller-and-the-enc28j60"><a href="#_1-an-spi-interface-that-serves-as-a-communication-channel-between-the-host-controller-and-the-enc28j60" class="header-anchor">#</a> 1. An SPI interface that serves as a communication channel between the host controller and the ENC28J60.</h4> <h4 id="_2-control-registers-which-are-used-to-control-and-monitor-the-enc28j60"><a href="#_2-control-registers-which-are-used-to-control-and-monitor-the-enc28j60" class="header-anchor">#</a> 2. Control Registers which are used to control and monitor the ENC28J60.</h4> <h4 id="_3-a-dual-port-ram-buffer-for-received-and-transmitted-data-packets"><a href="#_3-a-dual-port-ram-buffer-for-received-and-transmitted-data-packets" class="header-anchor">#</a> 3. A dual port RAM buffer for received and transmitted data packets.</h4> <h4 id="_4-an-arbiter-to-control-the-access-to-the-ram-buffer-when-requests-are-made-from-dma-transmit-and-receive-blocks"><a href="#_4-an-arbiter-to-control-the-access-to-the-ram-buffer-when-requests-are-made-from-dma-transmit-and-receive-blocks" class="header-anchor">#</a> 4. An arbiter to control the access to the RAM buffer when requests are made from DMA, transmit and receive blocks.</h4> <h4 id="_5-the-bus-interface-that-interprets-data-and-commands-received-via-the-spi-interface"><a href="#_5-the-bus-interface-that-interprets-data-and-commands-received-via-the-spi-interface" class="header-anchor">#</a> 5. The bus interface that interprets data and commands received via the SPI interface.</h4> <h4 id="_6-the-mac-medium-access-control-module-that-implements-ieee-802-3-compliant-mac-logic"><a href="#_6-the-mac-medium-access-control-module-that-implements-ieee-802-3-compliant-mac-logic" class="header-anchor">#</a> 6. The MAC (Medium Access Control) module that implements IEEE 802.3 compliant MAC logic.</h4> <h4 id="_7-the-phy-physical-layer-module-that-encodes-and-decodes-the-analog-data-that-is-present-on-the-twisted-pair-interface-the-device-also-contains-other-support-blocks-such-as-the-oscillator-on-chip-voltage-regulator-level-translators-to-provide-5v-tolerant-i-os-and-system-control-logic"><a href="#_7-the-phy-physical-layer-module-that-encodes-and-decodes-the-analog-data-that-is-present-on-the-twisted-pair-interface-the-device-also-contains-other-support-blocks-such-as-the-oscillator-on-chip-voltage-regulator-level-translators-to-provide-5v-tolerant-i-os-and-system-control-logic" class="header-anchor">#</a> 7. The PHY (Physical Layer) module that encodes and decodes the analog data that is present on the twisted pair interface. The device also contains other support blocks, such as the oscillator, on-chip voltage regulator, level translators to provide 5V tolerant I/Os and system control logic</h4> <img src="/spiblocks.png"> <h1 id="serial-peripheral-interface-spi"><a href="#serial-peripheral-interface-spi" class="header-anchor">#</a> SERIAL PERIPHERAL INTERFACE (SPI) :</h1> <p>The ENC28J60 is designed to interface directly with the Serial Peripheral Interface (SPI) port available on many micro-controllers. The implementation used on this device supports SPI mode 0,0 only. In addition, the SPI port requires that SCK be at Idle in a low state.</p> <span><ins data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6356177594937247" data-ad-slot="2874230806" class="adsbygoogle" style="display:block; text-align:center;"></ins> <div style="display:none;"> 
  (adsbygoogle = window.adsbygoogle || []).push({});
</div></span> <div class="language-c line-numbers-mode"><pre class="language-c"><code>    <span class="token comment">//SPI MODE 0 0 -&gt; CPOL , CPHA set to 0 0 which is already </span>
    <span class="token comment">//CPOL : This bit selects the clock polarity when the bus is idle</span>
    <span class="token comment">//CPHA : This bit determines when the data needs to be sampled.</span>
    <span class="token comment">// SPI Control Register(SPCR)</span>
    <span class="token comment">//SPE – (SPI Enable) The SPI Enable bit is used to enable SPI as a whole</span>
    <span class="token comment">// MSTR – Master/Slave Select This bit is used to configure the device as Master or as Slave</span>
    SPCR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span>SPE<span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span>MSTR<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//SPI Status Register(SPSR)</span>
    <span class="token comment">//Set this bit to 1 to enable SPI Double Speed Mode.</span>
    SPSR <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span>SPI2X<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Commands and data are sent to the device via the SI pin, with data being clocked in on the rising edge of SCK.</p> <img src="/spioutput.png"> <div style="float:right;">SPI™ INPUT TIMING.</div> <div style="clear:both;"></div> <p>Data is driven out by the ENC28J60 on the SO line, on the falling edge of SCK. The CS pin must be held low while any operation is performed and returned high when finished.</p> <img src="/spi%20timing%20diagram.png"> <div style="float:right;">SPI™ OUTPUT TIMING</div> <div style="clear:both;"></div> <h1 id="spi-instruction-set"><a href="#spi-instruction-set" class="header-anchor">#</a> SPI Instruction Set</h1> <p>The operation of the ENC28J60 depends entirely on commands given by an external host controller over the SPI interface. These commands take the form of instructions, of one or more bytes, which are used to access the control memory and Ethernet buffer spaces. At the least, instructions consist of a 3-bit opcode followed by a 5-bit argument that specifies either a register address or a data constant. Write and bit field instructions are also followed by one or more bytes of data. A total of seven instructions are implemented on the ENC28J60.</p> <img src="/spiinstruction.png"> <div style="float:right;">SPI™ INSTRUCTION SET</div> <div style="clear:both;"></div> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_READ_CTRL_REG       0x00</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_READ_BUF_MEM        0x3A</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_WRITE_CTRL_REG      0x40</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_WRITE_BUF_MEM       0x7A</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_BIT_FIELD_SET       0x80</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_BIT_FIELD_CLR       0xA0</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_SOFT_RESET          0xFF</span>

<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_CONTROL_PORT   PORTB</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_CONTROL_DDR    DDRB</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ENC28J60_CONTROL_CS     4</span>
<span class="token comment">// set CS to 0 = active</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CSACTIVE ENC28J60_CONTROL_PORT&amp;=~(1&lt;&lt;ENC28J60_CONTROL_CS)</span>
<span class="token comment">// set CS to 1 = passive</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CSPASSIVE ENC28J60_CONTROL_PORT|=(1&lt;&lt;ENC28J60_CONTROL_CS)</span>
<span class="token comment">//</span>
<span class="token macro property">#<span class="token directive keyword">define</span> waitspi() while(!(SPSR&amp;(1&lt;&lt;SPIF)))</span>
<span class="token comment">//Proper Blank Select Mechanism Should Implement</span>
<span class="token comment">//Read ControlOperation</span>
<span class="token keyword">void</span> <span class="token function">ReadControlRegister</span><span class="token punctuation">(</span>unit8_t address<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
       CSACTIVE<span class="token punctuation">;</span>
        <span class="token comment">// issue read command</span>
        <span class="token comment">//address is control register</span>
        SPDR <span class="token operator">=</span> ENC28J60_READ_CTRL_REG <span class="token operator">|</span> address<span class="token punctuation">;</span>
        <span class="token function">waitspi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// read data</span>
        SPDR <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
        <span class="token function">waitspi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// do dummy read if needed (for mac and mii, see datasheet page 29)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>address <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
                SPDR <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
                <span class="token function">waitspi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// release CS</span>
        CSPASSIVE<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>SPDR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//Proper Blank Select Mechanism Should Implement</span>
<span class="token comment">//Write ControlOperation</span>
<span class="token keyword">void</span> <span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>uint8_t address<span class="token punctuation">,</span> uint8_t data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

        CSACTIVE<span class="token punctuation">;</span>
        <span class="token comment">// issue write command</span>
        SPDR <span class="token operator">=</span> ENC28J60_READ_CTRL_REG <span class="token operator">|</span> address <span class="token punctuation">;</span>
        <span class="token function">waitspi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// write data</span>
        SPDR <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token function">waitspi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        CSPASSIVE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//Write ControlOperation</span>
<span class="token keyword">void</span> <span class="token function">BitFieldSet</span><span class="token punctuation">(</span>uint8_t address<span class="token punctuation">,</span> uint8_t data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

        CSACTIVE<span class="token punctuation">;</span>
        <span class="token comment">// issue write command</span>
        SPDR <span class="token operator">=</span> ENC28J60_BIT_FIELD_SET <span class="token operator">|</span> address <span class="token punctuation">;</span>
        <span class="token function">waitspi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// write data</span>
        SPDR <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token function">waitspi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        CSPASSIVE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><h1 id="memory-organization"><a href="#memory-organization" class="header-anchor">#</a> MEMORY ORGANIZATION :</h1> <p>All memory in the ENC28J60 is implemented as static RAM. There are three types of memory in the ENC28J60:</p> <ul><li> Control Registers</li> <li>Ethernet Buffer</li> <li>PHY Registers</li></ul>
Control Registers (CRs) are used for configuration, control and status retrieval of the ENC28J60. The Control Registers are directly read and written to by the SPI interface.
<p>The Ethernet buffer contains transmit and receive memory used by the Ethernet controller in a single memory space. The sizes of the memory areas are programmable by the host controller using the SPI interface. The Ethernet buffer memory can only be accessed via the read buffer memory and write buffer memory SPI commands</p> <span><ins data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6356177594937247" data-ad-slot="2874230806" class="adsbygoogle" style="display:block; text-align:center;"></ins> <div style="display:none;"> 
  (adsbygoogle = window.adsbygoogle || []).push({});
</div></span> <p>The PHY registers are used for configuration, control and status retrieval of the PHY module. The registers are not directly accessible through the SPI interface; they can only be accessed through the Media Independent Interface (MII) implemented in the MAC.</p> <h1 id="control-register"><a href="#control-register" class="header-anchor">#</a> Control Register</h1> <p>The Control Register memory is partitioned into four banks, selectable by the bank select bits BSEL1:BSEL0 in the ECON1 register. Each bank is 32 bytes long and addressed by a 5-bit address value.</p> <p>The last five locations (1Bh to 1Fh) of all banks point to a common set of registers: EIE, EIR, ESTAT, ECON2 and ECON1. These are key registers used in controlling and monitoring the operation of the device. Their common mapping allows easy access without switching the bank.</p> <img src="/controlregister.png"> <h1 id="initialization"><a href="#initialization" class="header-anchor">#</a> INITIALIZATION :</h1> <p>Before the ENC28J60 can be used to transmit and receive packets, certain device settings must be initial- ized. Depending on the application, some configuration options may need to be changed. Normally, these tasks may be accomplished once after Reset and do not need to be changed thereafter</p> <h4 id="receive-and-transmission-buffer"><a href="#receive-and-transmission-buffer" class="header-anchor">#</a> Receive and Transmission Buffer</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> ETXSTL           0x04</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ETXSTH           0x05</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ETXNDL           0x06</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ETXNDH           0x07</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ERXSTL           0x08</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ERXSTH           0x09</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ERXNDL           0x0A</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ERXNDH           0x0B</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ERXRDPTL         0x0C</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ERXRDPTH         0x0D</span>

<span class="token comment">// The RXSTART_INIT should be zero. See Rev. B4 Silicon Errata</span>
<span class="token comment">// buffer boundaries applied to internal 8K ram</span>
<span class="token comment">// the entire available packet buffer space is allocated</span>
<span class="token comment">//</span>
<span class="token comment">// start with recbuf at 0/</span>
<span class="token macro property">#<span class="token directive keyword">define</span> RXSTART_INIT     0x0</span>
<span class="token comment">// receive buffer end</span>
<span class="token macro property">#<span class="token directive keyword">define</span> RXSTOP_INIT      (0x1FFF-0x0600-1)</span>
<span class="token comment">// start TX buffer at 0x1FFF-0x0600, pace for one full ethernet frame (~1500 bytes)</span>
<span class="token macro property">#<span class="token directive keyword">define</span> TXSTART_INIT     (0x1FFF-0x0600)</span>
<span class="token comment">// stp TX buffer at end of mem</span>
<span class="token macro property">#<span class="token directive keyword">define</span> TXSTOP_INIT      0x1FFF</span>

<span class="token comment">// Rx start</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ERXSTL<span class="token punctuation">,</span> RXSTART_INIT<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ERXSTH<span class="token punctuation">,</span> RXSTART_INIT<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// set receive pointer address</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ERXRDPTL<span class="token punctuation">,</span> RXSTART_INIT<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ERXRDPTH<span class="token punctuation">,</span> RXSTART_INIT<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// RX end</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ERXNDL<span class="token punctuation">,</span> RXSTOP_INIT<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ERXNDH<span class="token punctuation">,</span> RXSTOP_INIT<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// TX start</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ETXSTL<span class="token punctuation">,</span> TXSTART_INIT<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ETXSTH<span class="token punctuation">,</span> TXSTART_INIT<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// TX end</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ETXNDL<span class="token punctuation">,</span> TXSTOP_INIT<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>ETXNDH<span class="token punctuation">,</span> TXSTOP_INIT<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="receive-filters"><a href="#receive-filters" class="header-anchor">#</a> Receive Filters</h4> <p>The appropriate receive filters should be enabled or disabled by writing to the ERXFCON register.</p> <h4 id="mac-initialization-settings"><a href="#mac-initialization-settings" class="header-anchor">#</a> MAC Initialization Settings</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> MACON1           0x00</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON2           0x01</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3           0x02</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MABBIPG          0x04</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAIPGL           0x06</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAIPGH           0x07</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAMXFLL          0x0A</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAMXFLH          0x0B</span>

<span class="token macro property">#<span class="token directive keyword">define</span> MAADR1           0x00</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAADR0           0x01</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAADR3           0x02</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAADR2           0x03</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAADR5           0x04</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MAADR4           0x05</span>

<span class="token macro property">#<span class="token directive keyword">define</span> MACON1_LOOPBK    0x10</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON1_TXPAUS    0x08</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON1_RXPAUS    0x04</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON1_PASSALL   0x02</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON1_MARXEN    0x01</span>

<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_PADCFG2   0x80</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_PADCFG1   0x40</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_PADCFG0   0x20</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_TXCRCEN   0x10</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_PHDRLEN   0x08</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_HFRMLEN   0x04</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_FRMLNEN   0x02</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MACON3_FULDPX    0x01</span>

<span class="token comment">// max frame length which the conroller will accept:</span>
<span class="token macro property">#<span class="token directive keyword">define</span>        MAX_FRAMELEN        1500        </span><span class="token comment">// (note: maximum ethernet frame length would be 1518)</span>

<span class="token comment">// enable MAC receive</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MACON1<span class="token punctuation">,</span> MACON1_MARXEN<span class="token operator">|</span>MACON1_TXPAUS<span class="token operator">|</span>MACON1_RXPAUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// bring MAC out of reset</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MACON2<span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// enable automatic padding to 60bytes and CRC operations</span>
<span class="token function">BitFieldSet</span><span class="token punctuation">(</span>MACON3<span class="token punctuation">,</span> MACON3_PADCFG0<span class="token operator">|</span>MACON3_TXCRCEN<span class="token operator">|</span>MACON3_FRMLNEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// set inter-frame gap (non-back-to-back)</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAIPGL<span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAIPGH<span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// set inter-frame gap (back-to-back)</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MABBIPG<span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Set the maximum packet size which the controller will accept</span>
<span class="token comment">// Do not send packets longer than MAX_FRAMELEN:</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAMXFLL<span class="token punctuation">,</span> MAX_FRAMELEN<span class="token operator">&amp;</span><span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAMXFLH<span class="token punctuation">,</span> MAX_FRAMELEN<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// write MAC address</span>
<span class="token comment">// NOTE: MAC address in ENC28J60 is byte-backward</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAADR5<span class="token punctuation">,</span> macaddr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAADR4<span class="token punctuation">,</span> macaddr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAADR3<span class="token punctuation">,</span> macaddr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAADR2<span class="token punctuation">,</span> macaddr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAADR1<span class="token punctuation">,</span> macaddr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MAADR0<span class="token punctuation">,</span> macaddr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h4 id="phy-initialization-settings"><a href="#phy-initialization-settings" class="header-anchor">#</a> PHY Initialization Settings</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property">#<span class="token directive keyword">define</span> PHCON2           0x10</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MIREGADR         0x14</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MIWRL            0x16</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MIWRH            0x17</span>

<span class="token macro property">#<span class="token directive keyword">define</span> PHCON2_FRCLINK   0x4000</span>
<span class="token macro property">#<span class="token directive keyword">define</span> PHCON2_TXDIS     0x2000</span>
<span class="token macro property">#<span class="token directive keyword">define</span> PHCON2_JABBER    0x0400</span>
<span class="token macro property">#<span class="token directive keyword">define</span> PHCON2_HDLDIS    0x0100</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MISTAT           0x0A</span>

<span class="token macro property">#<span class="token directive keyword">define</span> MISTAT_BUSY      0x01</span>

<span class="token keyword">void</span> <span class="token function">enc28j60PhyWrite</span><span class="token punctuation">(</span>uint8_t address<span class="token punctuation">,</span> uint16_t data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token comment">// set the PHY register address</span>
        <span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MIREGADR<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// write the PHY data</span>
        <span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MIWRL<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">WriteControlRegister</span><span class="token punctuation">(</span>MIWRH<span class="token punctuation">,</span> data<span class="token operator">&gt;&gt;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// wait until the PHY write completes</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">ReadControlRegister</span><span class="token punctuation">(</span>MISTAT<span class="token punctuation">)</span> <span class="token operator">&amp;</span> MISTAT_BUSY<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">_delay_us</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>	
<span class="token function">enc28j60PhyWrite</span><span class="token punctuation">(</span>PHCON2<span class="token punctuation">,</span> PHCON2_HDLDIS<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/avr/" class="prev router-link-active">
          Introduction
        </a></span> <!----></p></div> </main></div><div class="global-ui"><div class="reading-progress top" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div><!----></div></div>
    <script src="/assets/js/app.b9d4e7ea.js" defer></script><script src="/assets/js/3.32f2e6ee.js" defer></script><script src="/assets/js/22.5a6e4eea.js" defer></script><script src="/assets/js/9.20302103.js" defer></script>
  </body>
</html>
